:root {
    /* Oak Palette */
    --color-wood-dark: #654321;   /* Dark Brown/Oak */
    --color-wood-medium: #8D6E63; /* Medium Brown */
    --color-paper: #FFF8E1;      /* Off-White/Cream Paper */
    --color-accent: #B0BEC5;     /* Silver/Steel (Consultant/Developer feel) */
    --color-text-dark: #3E2723;  /* Deep Brown Text */
}

body {
    font-family: 'Arial', sans-serif;
    background-color: var(--color-paper);
    :root {
        /* Oak Palette */
        --color-wood-dark: #654321;   /* Dark Brown/Oak */
        --color-wood-medium: #8D6E63; /* Medium Brown */
        --color-paper: #FFF8E1;      /* Off-White/Cream Paper */
        --color-accent: #B0BEC5;     /* Silver/Steel (Consultant/Developer feel) */
        --color-text-dark: #3E2723;  /* Deep Brown Text */
    }

    body {
        font-family: 'Arial', sans-serif;
        background-color: var(--color-paper);
        color: var(--color-text-dark);
        margin: 0;
        padding: 0;
        line-height: 1.6;
    }

    /* If a background image is present, provide a subtle dark overlay to maintain
         legibility while keeping the oak aesthetic. The class `has-bg-image` is set
         by the frontend when a config background is applied. */
    body.has-bg-image {
        position: relative;
    }

    body.has-bg-image::before {
        content: "";
        position: fixed;
        inset: 0;
        background: rgba(34, 28, 22, 0.35); /* subtle warm-dark overlay */
        pointer-events: none;
        z-index: 0;
    }

    /* Make main content sit above the overlay */
    main, header {
        position: relative;
        z-index: 1;
    }

    header {
        background-color: var(--color-wood-dark);
        color: var(--color-paper);
        padding: 20px 40px;
        text-align: center;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    h1 { margin-bottom: 5px; }
    h2 { color: var(--color-wood-dark); border-bottom: 2px solid var(--color-accent); padding-bottom: 5px; }

    /* Toolbar (import UI) */
    .toolbar {
      display: flex;
      gap: .75rem;
      align-items: center;
      margin: .75rem 0 1rem;
    }

    /* Dashboard Layout */
    .dashboard {
        display: grid;
        grid-template-columns: 2fr 1fr 1fr; /* Plot is wider */
        gap: 20px;
        padding: 20px;
    }

    .board {
        background-color: var(--color-wood-medium);
        padding: 15px;
        border-radius: 8px;
        box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.4); /* Inner shadow for depth */
        min-height: 400px;
    }

    /* Cards (Notes/Elements) */
    .card {
        background-color: var(--color-paper);
        border: 1px solid var(--color-wood-medium);
        padding: 10px;
        margin-bottom: 10px;
        border-radius: 4px;
        box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1);
        cursor: move; /* Indicates it can be moved */
    }

    .card h3 {
        margin-top: 0;
        /* =========================
             THEME TOKENS
             ========================= */
        :root{
            /* brand */
            --wood-900:#4E3A2B;
            --wood-700:#7A5C43;
            --paper:#FFF7EA;
            --ink:#2F251D;
            --steel:#B0BEC5;
            --crimson:#B71C1C;

            /* layout */
            --radius:12px;
            --gap:18px;
            --shadow:0 8px 24px rgba(0,0,0,.18);
            --overlay:rgba(28,22,18,.45);

            /* typography */
            --fs-0:12px; --fs-1:14px; --fs-2:16px; --fs-3:18px; --fs-4:22px; --fs-5:28px;
            --lh:1.55;
        }

        :root[data-theme="dark"]{
            --paper:#F3E9D8;
            --ink:#1C1A19;
            --overlay:rgba(0,0,0,.5);
        }

        :root[data-theme="sepia"]{
            --paper:#FFF4DE;
            --ink:#2a2018;
            --overlay:rgba(35,26,18,.45);
        }

        /* =========================
             BASE
             ========================= */
        *{box-sizing:border-box}
        html,body{height:100%}
        body{
            font-family: system-ui, Segoe UI, Inter, Roboto, Arial, sans-serif;
            color:var(--ink);
            background:var(--paper);
            margin:0;
            line-height:var(--lh);
        }

        /* Background image with soft overlay */
        body.has-bg{
            background-image:url('background.png');
            background-size:cover; background-attachment:fixed; background-position:center;
        }
        body.has-bg::before{
            content:""; position:fixed; inset:0; z-index:0;
            background:var(--overlay);
            pointer-events:none;
        }

        /* Layer content */
        header, main, nav, .toolbar, .room{ position:relative; z-index:1 }

        /* -------------------------
             HEADER + NAV
             ------------------------- */
        header{
            background:linear-gradient(180deg, rgba(78,58,43,.96), rgba(78,58,43,.88));
            color:var(--paper);
            padding:22px 28px;
            box-shadow:var(--shadow);
        }
        header h1{margin:0 0 4px; font-size:var(--fs-5); letter-spacing:.3px}
        header p{margin:0; opacity:.9; font-size:var(--fs-2)}

        nav.site-nav{
            position:sticky; top:0; z-index:2;
            display:flex; gap:8px; padding:10px 12px;
            background:rgba(255,247,234,.65); backdrop-filter:saturate(1.2) blur(6px);
            border-bottom:1px solid rgba(0,0,0,.05);
        }
        nav.site-nav a{
            text-decoration:none; color:#1d1d1d; font-weight:600;
            padding:8px 12px; border-radius:8px; font-size:var(--fs-2);
        }
        nav.site-nav a.active{ background:var(--paper); box-shadow:var(--shadow) }
        nav.site-nav a:hover{ background:#fff }

        /* -------------------------
             TOOLBAR
             ------------------------- */
        .toolbar{ display:flex; gap:.75rem; align-items:center; padding:10px 12px }

        /* -------------------------
             LAYOUT
             ------------------------- */
        .dashboard{
            display:grid; gap:var(--gap); padding:20px;
            grid-template-columns: 2fr 1fr 1fr; /* tweak per screen via media */
        }
        @media (max-width: 1100px){
            .dashboard{ grid-template-columns:1fr; }
        }

        /* -------------------------
             BOARDS / CARDS
             ------------------------- */
        .board{
            background:rgba(122,92,67,.92);
            padding:14px; border-radius:var(--radius);
            box-shadow: inset 0 0 10px rgba(0,0,0,.35);
            min-height:380px; max-height:70vh; overflow:auto;
        }
        .board h2{color:#fff; margin:6px 6px 12px}

        .card{
            background:var(--paper); border:1px solid rgba(0,0,0,.08);
            padding:12px; margin-bottom:12px; border-radius:10px; box-shadow:var(--shadow);
            transition: transform .18s ease, box-shadow .18s ease;
        }
        .card:hover{ transform: translateY(-2px) }
        .card h3{margin:0 0 6px; color:var(--wood-900); font-size:var(--fs-3)}
        [contenteditable="true"]{border:1px dashed var(--steel); padding:6px; min-height:22px; display:block}

        /* Buttons */
        button{
            background:var(--wood-900); color:var(--paper); border:none;
            padding:8px 14px; border-radius:8px; cursor:pointer; font-weight:700;
            box-shadow:0 2px 8px rgba(0,0,0,.2);
        }
        button:hover{ filter:brightness(.95) }
        button:focus{ outline:2px solid var(--steel); outline-offset:2px }
        .delete-btn{ background:var(--crimson); float:right; padding:6px 9px; font-size:.85rem }

        /* Focus ring on editable */
        .card:focus-within{ outline:2px solid var(--steel); outline-offset:2px }

        /* -------------------------
             ROOM PAGES
             ------------------------- */
        .room{ display:none; }
        .room.active{ display:block; animation:fade .22s ease }
        @keyframes fade{ from{opacity:0; transform:translateY(6px)} to{opacity:1; transform:none} }

        /* Sticky-Notes room */
        .room-sticky{ padding:24px; max-width:1200px; margin:0 auto; }
        .cork{
            background-image:
                radial-gradient(rgba(0,0,0,.05) 2px, transparent 3px),
                radial-gradient(rgba(0,0,0,.04) 1px, transparent 3px);
            background-size:14px 14px, 18px 18px; background-position:0 0, 6px 6px;
            background-color:#CEB299;
            border-radius:12px; padding:18px; box-shadow:var(--shadow); min-height:60vh;
        }
        .notes-grid{ display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:16px }
        .note{
            width:220px; min-height:120px; padding:10px 12px; background:#FFF08A;
            border:1px solid rgba(0,0,0,.08); border-radius:6px; box-shadow:0 10px 12px rgba(0,0,0,.18);
            position:relative;
        }
        .note:before{
            content:""; position:absolute; width:40px; height:12px; background:#d44;
            left:50%; top:-6px; transform:translateX(-50%); border-radius:3px; box-shadow:0 2px 6px rgba(0,0,0,.25);
        }
        .note[contenteditable="true"]{ border:0; min-height:80px }

        /* Reduced motion */
        @media (prefers-reduced-motion: reduce){
            *{ animation:none !important; transition:none !important }
        }
